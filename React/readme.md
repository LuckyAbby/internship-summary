## 记录下来实习期间踩的 React 的坑

### 1.当React里面需要发送Ajax请求的时
React不负责处理网络请求，如果想在React里面处理网络请求，一般是在componentDidMount阶段发送Ajax请求，那得到的数据应该存放在哪里？

我认为，得到的数据都应该是之前存放在组件的state里面，再通过setState去更新UI的变化，那在整个项目中到底这些state应该放在哪个组件里面呢？

1. 所有数据都存放在最外层组件里

在最外层的父组件里面去发送Ajax请求，然后将数据作为props传给子组件，但是这种方式的缺点就是如果项目特别大，子组件需要的数据特别多，那么父组件又需要维护一份子组件的state,这样会导致父组件可能不停地被重绘，性能不好，同时如果项目层级嵌套比较深，数据一层一层下传也不方便。

2. 让子组件自己发Ajax维护自己的state

如果一个子组件需要的数据比较多，比如可能是一个表单组件，这个时候如果让父组件去维护整个state，可能会导致性能不好，让子组件自己去发送Ajax去拿到自己的数据，然后维护自己的state,最后再暴露出一个接口，可以将父组件需要的数据返回出去，父组件通过ref取得子组件，再调用上面的方法，就可以拿到子组件的值，这样的优点是让组件维护自己的state,避免一些不必要的重绘。缺点就是有时候如果子组件比较多，嵌套层级比较深，可能会导致数据在父子组件、兄弟组件之间传递很混乱。

3. 使用redux

使用redux管理状态和数据之后所有的网络请求都有redux去完成，因为自己redux不是很熟，所以也没有很多经验，这里先保留，等之后研究了再写。

### 2.父子组件之间通信

父子组件之间的通信分为两种，子组件拿到父组件的数据以及父组件拿到子组件的数据。

##### 1.子组件拿到父组件的数据
子组件拿到父组件的数据很简单，只要父组件把想传递的值 name 当成 props 传进来，子组件通过 this.props.name 就可以拿到父组件的 name ，这种方式也是符合 React 单项数据流的，即任何状态始终由某些特定组件所有，并且从该状态导出的任何数据或 UI 只能影响树中下方的组件。

##### 2.父组件拿到子组件的数据
父组件想要拿到子组件的数据，一般有两种方式：

1. 父组件主动去拿数据
这种模式一般是通过 ref 实现的，React 支持给任意组件添加特殊属性。ref属性接受一个回调函数，它在组件被加载或卸载时会立即执行。

当给 HTML 元素添加 ref 属性时，ref 回调接收了底层的 DOM 元素作为参数，这样就可以拿到子组件。在旧版API中是使用 this.refs 来拿到值的（不建议使用，未来可能会被废弃），但是这种方法不好之处在于只能拿到实例的值，因此不能在函数式组件上面使用，因为他们没有实例。同时这种方法会破坏封装性，不是特别推荐使用。

2. 子组件一直推数据给父组件。
比较形象的就是回调函数，在父组件里定义回调函数，然后将回调函数传递给子组件，然后父组件就可以通过这个回调函数拿到子组件的值了。这种比较典型的就是子组件是 input,父组件需要拿到 input 的值， 在父组件上面定义一个回调函数，子组件每次 onChange 的时候就会执行这个回调函数，父组件就能拿到这个值。